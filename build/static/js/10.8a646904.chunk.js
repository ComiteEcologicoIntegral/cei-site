(this.webpackJsonpcei=this.webpackJsonpcei||[]).push([[10],{147:function(e,t,n){"use strict";n.r(t);var c=n(83),r=n(27);var a=n(42);function i(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=n(33),s=n(0),u=n(109),l=n(144),b=n(134),j=n(89),d=n(82),f=n(3),O=function(e){var t=Object(s.useRef)(e.id),n=e.sensores,c=Object(s.useState)("PurpleAir"),r=Object(o.a)(c,2),a=r[0],i=r[1],O=Object(s.useState)(d.e),m=Object(o.a)(O,2),h=m[0],p=m[1],x=Object(s.useState)(null),v=Object(o.a)(x,2),y=v[0],g=v[1],P=Object(s.useRef)(n[0].zona?n[0].zona:null),S=Object(s.useRef)(d.e[0].value),C=Object(s.useRef)(null),N=Object(s.useRef)(null),k=Object(s.useRef)("00:00:00"),w=Object(s.useRef)("00:00:00");Object(s.useEffect)((function(){p("PurpleAir"===a?[d.e[0]]:d.e)}),[a]);var M=Object(s.useMemo)((function(){return n.filter((function(e){return e.sistema===a&&!d.d.includes(e.Sistema)})).map((function(e){return{value:e.sensor_id,label:e.zona}}))}),[n,a]);function _(){var n={ubic:P.current,ind:S.current,desde:C.current,hasta:N.current,desdeHora:k.current,hastaHora:w.current};e.modifyData(n,t.current)}return Object(f.jsx)(u.a,{sm:6,children:Object(f.jsx)("div",{className:"compara-filtros mt-2 mb-4",id:"filtro-"+t.current,children:Object(f.jsxs)(l.a,{children:[Object(f.jsx)(l.a.Group,{as:b.a,children:Object(f.jsx)(u.a,{sm:12,children:Object(f.jsxs)(b.a,{children:[Object(f.jsxs)(u.a,{sm:6,children:[Object(f.jsx)(j.a,{options:d.g,placeholder:"Sistema",className:"mb-2",onChange:function(e){i(e.value),g(null),P.current=null,_()}}),Object(f.jsx)(j.a,{options:M,value:y,placeholder:"Ubicaci\xf3n",className:"mb-2",onChange:function(e){g(e),P.current=e,_()}})]}),Object(f.jsx)(u.a,{sm:6,children:Object(f.jsx)(j.a,{options:h,defaultValue:d.e[0],onChange:function(e){S.current=e.value,_()}})})]})})}),Object(f.jsx)(l.a.Group,{as:b.a,children:Object(f.jsx)(u.a,{sm:12,children:Object(f.jsxs)(b.a,{children:[Object(f.jsxs)(u.a,{sm:6,children:[Object(f.jsxs)(b.a,{children:[Object(f.jsx)(u.a,{sm:3,children:Object(f.jsx)("p",{children:"Desde:"})}),Object(f.jsx)(u.a,{sm:9,children:Object(f.jsx)(l.a.Control,{className:"cf-input",type:"date",onChange:function(e){C.current=e.target.value,_()}})})]}),Object(f.jsxs)(b.a,{children:[Object(f.jsx)(u.a,{sm:3}),Object(f.jsx)(u.a,{sm:9,children:Object(f.jsx)(l.a.Control,{onChange:function(e){k.current=e.target.value+":00",_()},type:"time"})})]})]}),Object(f.jsxs)(u.a,{sm:6,children:[Object(f.jsxs)(b.a,{children:[Object(f.jsx)(u.a,{sm:3,children:Object(f.jsx)("p",{children:"Hasta:"})}),Object(f.jsx)(u.a,{sm:9,children:Object(f.jsx)(l.a.Control,{className:"cf-input",type:"date",onChange:function(e){N.current=e.target.value,_()}})})]}),Object(f.jsxs)(b.a,{children:[Object(f.jsx)(u.a,{sm:3}),Object(f.jsx)(u.a,{sm:9,children:Object(f.jsx)(l.a.Control,{onChange:function(e){w.current=e.target.value+":00",_()},type:"time"})})]})]})]})})})]})})})},m=n(120),h=n(87),p=n(37),x=n(39),v=n(34),y=n.n(v),g=(n(95),n(107)),P=n.n(g);t.default=function(){var e=Object(p.b)(),t=Object(p.c)((function(e){return e})),n=t.sensorDataLastUpdate,r=t.sensorData,a=Object(s.useState)(null),l=Object(o.a)(a,2),j=l[0],v=l[1],g=[];Object(s.useEffect)((function(){(n?y()().diff(n,"minutes"):999)>60?Object(h.a)().then((function(t){e(Object(x.b)(t)),v(t)})).catch((function(e){return console.error(e)})):v(r)}),[]),j&&j.forEach((function(e){g.push({sensor_id:e.Sensor_id,zona:e.Zona,sistema:e.Sistema})}));var S=Object(s.useRef)(-1),C=Object(s.useState)([]),N=Object(o.a)(C,2),k=N[0],w=N[1],M=Object(s.useRef)([]),_=Object(s.useState)(null),A=Object(o.a)(_,2),R=A[0],E=A[1],D=Object(s.useState)(!1),H=Object(o.a)(D,2),T=H[0],I=H[1];function L(e,t){M.current[t]=e}Object(s.useEffect)((function(){!function(){var e=[];if(R){for(var t=function(t){var n=g.find((function(e){return e.sensor_id===M.current[t].ubic.value})).zona,r="PM25"===M.current[t].ind?"PM2.5":M.current[t].ind;switch(Q(r),r){case"PM2.5":Y(15);break;case"PM10":Y(45);break;case"O3":Y(.051);break;case"NO2":Y(.013);break;case"SO2":Y(.015);break;default:Y(null)}if(R[t].name="".concat(n," (").concat(r,")"),R[t].type="scatter",R[t].mode="lines",R[t].marker={color:X[t]},R[t].text=R[t].dia.map((function(e){return y.a.utc(new Date(e)).format("DD-MM-YYYY HH:mm:ss")})),R[t].hovertemplate="<i>Medida</i>: %{y:.4f}<br><b>%{text}</b>",e.push(R[t]),"PM2.5"===r||"PM10"===r){var a=Object(c.a)({},R[t]);a.name="".concat(n," (").concat(r,") Promedio movil 24h"),a.marker={color:$[t]},a.y=a.moving_average,e.push(a);var i=Object(c.a)({},R[t]);i.name="".concat(n," (").concat(r,") Indice Aire y Salud"),i.marker={color:ee[t]},i.y=i.ICAR,e.push(i)}else if("SO2"===r){var o=Object(c.a)({},R[t]);o.name="".concat(n," (").concat(r,") Promedio movil 24h"),o.marker={color:$[t]},o.y=o.moving_average,e.push(o)}else if("CO"===r){var s=Object(c.a)({},R[t]);s.name="".concat(n," (").concat(r,") Promedio movil 8h"),s.marker={color:$[t]},s.y=s.moving_average,e.push(s)}},n=0;n<R.length;n++)t(n);J(e)}}()}),[R]);var z=Object(s.useState)(null),G=Object(o.a)(z,2),U=G[0],Y=G[1],K={title:{text:"Compara datos"},showlegend:!0,hovermode:"closest",width:1e3,height:700},W=Object(s.useState)([]),B=Object(o.a)(W,2),F=B[0],J=B[1],V=Object(s.useState)(null),Z=Object(o.a)(V,2),q=Z[0],Q=Z[1],X=["red","green","blue","orange"],$=["purple","pink","black","cyan"],ee=["orange","brown","grey","maroon"];return Object(f.jsxs)("div",{className:"container mt-5",children:[Object(f.jsxs)("div",{className:"ta-center mb-5",children:[Object(f.jsx)("h2",{children:"Compara datos"}),Object(f.jsx)("p",{children:"Compara la calidad del aire en diferente lugar y tiempo"})]}),Object(f.jsx)("hr",{className:"mb-4"}),Object(f.jsx)(b.a,{className:"mt-2 mb-1 d-flex justify-content-center",id:"filtros",children:k}),Object(f.jsx)(b.a,{className:"d-flex justify-content-end",children:Object(f.jsxs)(u.a,{sm:6,className:"d-flex justify-content-between",children:[Object(f.jsx)(m.a,{onClick:function(){S.current<3&&(S.current=S.current+1,w([].concat(i(k),[Object(f.jsx)(O,{id:S.current,modifyData:L,sensores:g})])))},children:"Agregar un filtro"}),Object(f.jsx)(m.a,{onClick:function(){return function(){if(-1!=S.current){var e=document.getElementById("filtro-".concat(S.current)).parentNode;e.parentNode.removeChild(e),S.current=S.current-1}}()},children:"Eliminar un filtro"}),Object(f.jsx)(m.a,{onClick:function(){return function(){if(!(S.current<0)){for(var e="",t="",n="",c="",r=0;r<=S.current;r++){if(!(M.current[r]&&M.current[r].desde&&M.current[r].hasta))return void alert("Selecciona las fechas");e+=M.current[r].ubic.label+",",t+=M.current[r].ind+",",n+=M.current[r].desde+"/"+M.current[r].desdeHora+",",c+=M.current[r].hasta+"/"+M.current[r].hastaHora+","}e=e.slice(0,-1),t=t.slice(0,-1),n=n.slice(0,-1),c=c.slice(0,-1);var a="ubic=".concat(e,"&ind=").concat(t,"&inicio=").concat(n,"&fin=").concat(c);I(!0),fetch("".concat(d.a,"/compare?").concat(a)).then((function(e){return e.json()})).then((function(e){I(!1),E(e)}))}}()},children:"Generar gr\xe1fica"})]})}),Object(f.jsx)(b.a,{children:Object(f.jsxs)(u.a,{sm:12,children:[Object(f.jsx)("div",{className:"text-center",children:Object(f.jsx)("img",{src:"loading.gif",alt:"Cargando...",className:"loading",style:T?{}:{display:"none"}})}),Object(f.jsx)("div",{class:"grafico-compara mt-5",children:Object(f.jsx)(P.a,{data:F,layout:R?Object(c.a)(Object(c.a)({},K),{},{shapes:function(){var e,t,n,c,r,a,i,o,s,u;switch(q){case"PM2.5":e=0,t=25,n=25,c=45,r=45,a=79,i=79,o=147,s=147,u=172;break;case"PM10":e=0,t=50,n=50,c=75,r=75,a=155,i=155,o=235,s=235,u=255;break;case"O3":e=0,t=.051,n=.051,c=.07,r=.07,a=.092,i=.092,o=.114,s=.114,u=.139;break;case"CO":e=0,t=8.75,n=8.75,c=11,r=11,a=13.3,i=13.3,o=15.5,s=15.5,u=17.5;break;case"NO2":e=0,t=.107,n=.107,c=.21,r=.21,a=.23,i=.23,o=.25,s=.25,u=.275;break;case"SO2":e=0,t=.008,n=.008,c=.11,r=.11,a=.165,i=.165,o=.22,s=.22,u=.255;break;default:e=0,t=25,n=25,c=45,r=45,a=79,i=79,o=147,s=147,u=172}return[{type:"rect",xref:"paper",x0:0,y0:e,x1:1,y1:t,fillcolor:"rgb(0, 228, 0)",opacity:.3,line:{width:0}},{type:"rect",xref:"paper",x0:0,y0:n,x1:1,y1:c,fillcolor:"rgb(255, 255, 0)",opacity:.3,line:{width:0}},{type:"rect",xref:"paper",x0:0,y0:r,x1:1,y1:a,fillcolor:"rgb(255, 126, 0)",opacity:.3,line:{width:0}},{type:"rect",xref:"paper",x0:0,y0:i,x1:1,y1:o,fillcolor:"rgb(255, 0, 0)",opacity:.3,line:{width:0}},{type:"rect",xref:"paper",x0:0,y0:s,x1:1,y1:u,fillcolor:"rgb(143, 63, 151)",opacity:.3,line:{width:0}},{type:"line",xref:"paper",x0:0,y0:U,x1:1,y1:U,line:{color:"#4682b4",width:2,dash:"dash"}}]}(),annotations:[{xref:"paper",x:1.01,y:U,xanchor:"left",yanchor:"middle",text:"L\xedmite recomendado <br>por la OMS 24h",showarrow:!1,font:{family:"Arial",size:12,color:"white"},bgcolor:"#4682b4"}]}):Object(c.a)({},K)})})]})})]})}},82:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return l}));var c=[{name:"PM25",label:"PM2.5",units:"\u03bcg/m3"},{name:"PM10",units:"\u03bcg/m3"},{name:"O3",units:"ppm"},{name:"CO",units:"ppm"},{name:"NO2",units:"ppm"},{name:"SO2",units:"ppm"}],r=[{value:"PurpleAir",label:"PurpleAir",opt:"P"},{value:"Sinaica",label:"Sinaica",opt:"G"},{value:"AireNuevoLeon",label:"AireNuevoLeon",opt:"G"}],a=[{value:"PM25",label:"PM2.5"},{value:"PM10",label:"PM10"},{value:"O3",label:"O3"},{value:"CO",label:"CO"},{value:"NO2",label:"NO2"},{value:"SO2",label:"SO2"}],i={PM25:"\xb5g/m3",PM10:"\xb5g/m3",CO:"ppm",O3:"ppm",NO2:"ppm",SO2:"ppm"},o=["P36757","P47305","P39499","P46239","P50855","P35099","P39709","P39497","P39285","P39355"],s=["P39497","P39285","P39355"],u=["Sinaica"],l=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL},87:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(82),r=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(r,a){t().then(r).catch((function(){setTimeout((function(){if(!c)return a("Se excedi\xf3 el n\xfamero m\xe1ximo de intentos");e(t,n,c-1).then(r,a)}),n)}))}))},a=function(){return new Promise((function(e,t){fetch("".concat(c.a,"/sensor-summary")).then((function(e){if(200===e.status)return e.json();t()})).then((function(t){e(t)})).catch((function(e){return t(e)}))}))},i=function(){return r(a)}}}]);
//# sourceMappingURL=10.8a646904.chunk.js.map