(this.webpackJsonpcei=this.webpackJsonpcei||[]).push([[11],{148:function(e,t,a){"use strict";a.r(t);var n=a(83),c=a(33),s=a(0),l=a.n(s),r=a(34),i=a.n(r),o=a(144),u=a(109),d=a(1),j=a(2),b=a(5),m=a.n(b),O=a(8),f=l.a.forwardRef((function(e,t){var a=e.bsPrefix,n=e.size,c=e.toggle,s=e.vertical,r=e.className,i=e.as,o=void 0===i?"div":i,u=Object(j.a)(e,["bsPrefix","size","toggle","vertical","className","as"]),b=Object(O.a)(a,"btn-group"),f=b;return s&&(f=b+"-vertical"),l.a.createElement(o,Object(d.a)({},u,{ref:t,className:m()(r,f,n&&b+"-"+n,c&&b+"-toggle")}))}));f.displayName="ButtonGroup",f.defaultProps={vertical:!1,toggle:!1,role:"group"};var x=f,h=a(120),v=function(){},p=l.a.forwardRef((function(e,t){var a=e.children,n=e.name,c=e.className,r=e.checked,i=e.type,o=e.onChange,u=e.value,b=e.disabled,O=e.inputRef,f=Object(j.a)(e,["children","name","className","checked","type","onChange","value","disabled","inputRef"]),x=Object(s.useState)(!1),p=x[0],g=x[1],N=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&g(!0)}),[]),y=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&g(!1)}),[]);return l.a.createElement(h.a,Object(d.a)({},f,{ref:t,className:m()(c,p&&"focus",b&&"disabled"),type:void 0,active:!!r,as:"label"}),l.a.createElement("input",{name:n,type:i,value:u,ref:O,autoComplete:"off",checked:!!r,disabled:!!b,onFocus:N,onBlur:y,onChange:o||v}),a)}));p.displayName="ToggleButton";var g=p,N=a(37),y=a(89),P=a(87),S=a(39),C=a(82),D=a(3),Y=[{value:"PurpleAir",label:"PurpleAir",opt:"P"},{value:"AireNuevoLeon",label:"AireNuevoLeon/Sinaica",opt:"G"}];var M=function(e){var t=e.createQueryGraph,a=e.createQueryCal,n=e.radioValue,l=e.setRadioValue,r=e.updateMainFiltros,d=Object(N.b)(),j=Object(N.c)((function(e){return e})),b=j.sensorDataLastUpdate,m=j.sensorData,O=Object(s.useState)(null),f=Object(c.a)(O,2),v=f[0],p=f[1],M=[];Object(s.useEffect)((function(){(b?i()().diff(b,"minutes"):999)>60?Object(P.a)().then((function(e){d(Object(S.b)(e)),p(e)})).catch((function(e){return console.error(e)})):p(m)}),[]);var R=Object(s.useState)(""),E=Object(c.a)(R,2),L=E[0],_=E[1],k=Object(s.useState)(C.e),w=Object(c.a)(k,2),A=w[0],H=w[1],T=Object(s.useState)(null),F=Object(c.a)(T,2),U=F[0],z=F[1],G=Object(s.useRef)(null),V=Object(s.useRef)(null),B=Object(s.useRef)(C.e[0]);return Object(s.useEffect)((function(){"PurpleAir"===L.value?H([C.e[0]]):H(C.e)}),[L]),v&&v.forEach((function(e){L.value!==e.Sistema||C.d.includes(e.Sensor_id)||M.push({value:e.Sensor_id,label:e.Zona})})),Object(D.jsxs)("div",{className:"mt-5",children:[Object(D.jsxs)("div",{className:"ta-center mb-5",children:[Object(D.jsx)("h2",{children:"Registro Hist\xf3rico"}),Object(D.jsx)("p",{children:"Consulta los datos hist\xf3ricos de la calidad del aire"})]}),Object(D.jsxs)(o.a,{children:[Object(D.jsxs)(o.a.Row,{className:"mb-3",children:[Object(D.jsx)(u.a,{xs:6,children:Object(D.jsx)(y.a,{options:Y,placeholder:"Sistema",onChange:function(e){z(null),V.current=null,G.current=e,_(e)}})}),Object(D.jsx)(u.a,{xs:6,children:Object(D.jsx)(y.a,{options:M,value:U,placeholder:"Ubicaci\xf3n",onChange:function(e){z(e),V.current=e}})})]}),Object(D.jsxs)(o.a.Row,{children:[Object(D.jsx)(u.a,{children:Object(D.jsx)(x,{toggle:!0,children:[{name:"Grafica",value:"1"},{name:"Calendario",value:"2"}].map((function(e,t){return Object(D.jsx)(g,{className:"toggle-vista",type:"radio",variant:"light",name:"radio",value:e.value,checked:n===e.value,onChange:function(e){return l(e.currentTarget.value)},children:e.name},t)}))})}),Object(D.jsx)(u.a,{className:"mb-3",children:Object(D.jsx)(y.a,{options:A,placeholder:"Indicador",onChange:function(e){B.current=e},defaultValue:C.e[0]})}),Object(D.jsx)(u.a,{xs:12,sm:3,className:"mb-3",children:Object(D.jsx)(h.a,{className:"btn-aplicar",variant:"primary",block:!0,onClick:function(){return r(V.current,B.current,G.current),void("1"===n?t():a())},children:"Aplicar"})})]})]}),Object(D.jsx)("hr",{className:"mt-2 mb-4"})]})},R=a(134),E=a(107),L=a.n(E);var _=function(e){var t=e.setDesde,a=e.setHasta,n=e.setDesdeHora,c=e.setHastaHora,l=e.data,r=e.layout,d=e.downloadFile,j=e.summary;return Object(s.useEffect)((function(){t(null),a(null),n("00:00:00"),c("00:00:00")}),[]),Object(D.jsxs)("div",{children:[Object(D.jsx)(o.a,{className:"mt-4 mb-4",children:Object(D.jsxs)(o.a.Row,{className:"d-flex justify-content-evenly",children:[Object(D.jsx)(u.a,{xs:12,lg:5,className:"mb-3",children:Object(D.jsxs)(R.a,{children:[Object(D.jsx)(u.a,{xs:2,children:Object(D.jsxs)(o.a.Label,{className:"col-form-label",children:["Desde:"," "]})}),Object(D.jsx)(u.a,{xs:5,children:Object(D.jsx)(o.a.Control,{type:"date",required:!0,onChange:function(e){return t(i()(e.target.value))}})}),Object(D.jsx)(u.a,{xs:5,children:Object(D.jsx)(o.a.Control,{onChange:function(e){return n(e.target.value+":00")},type:"time"})})]})}),Object(D.jsx)(u.a,{xs:12,lg:5,className:"mb-3",children:Object(D.jsxs)(R.a,{children:[Object(D.jsx)(u.a,{xs:2,children:Object(D.jsxs)(o.a.Label,{className:"col-form-label",children:["Hasta:"," "]})}),Object(D.jsx)(u.a,{xs:5,children:Object(D.jsx)(o.a.Control,{type:"date",required:!0,onChange:function(e){return a(i()(e.target.value))}})}),Object(D.jsx)(u.a,{xs:5,children:Object(D.jsx)(o.a.Control,{onChange:function(e){return c(e.target.value+":00")},type:"time"})})]})})]})}),Object(D.jsxs)(R.a,{className:"mb-5",children:[Object(D.jsxs)(u.a,{xs:12,lg:4,xl:2,children:[Object(D.jsx)(R.a,{xs:12,children:Object(D.jsx)(h.a,{className:"btn btn-light mb-4",block:!0,onClick:function(){d()},children:"Descargar datos"})}),Object(D.jsxs)(R.a,{className:"d-flex justify-content-center",children:[Object(D.jsx)(u.a,{xs:6,sm:5,lg:12,children:Object(D.jsxs)(R.a,{className:"dato-calculado d-flex justify-content-center",children:[Object(D.jsxs)(R.a,{sm:12,children:[Object(D.jsx)("p",{className:"tipo text-center",children:"M\xe1ximo"}),Object(D.jsx)("p",{className:"desc text-center",children:j&&(null===j||void 0===j?void 0:j.max.date)?"Registrado el ".concat(null===j||void 0===j?void 0:j.max.date):""})]}),Object(D.jsx)(R.a,{sm:12,className:"d-flex align-items-center justify-content-end",children:Object(D.jsx)("p",{className:"numero muymala text-center",children:j&&"number"===typeof(null===j||void 0===j?void 0:j.max.value)?j.max.value.toFixed(2):"-"})})]})}),Object(D.jsx)(u.a,{xs:6,sm:5,lg:12,children:Object(D.jsxs)(R.a,{className:"dato-calculado d-flex justify-content-center",children:[Object(D.jsxs)(R.a,{sm:12,children:[Object(D.jsx)("p",{className:"tipo text-center",children:"M\xednimo"}),Object(D.jsx)("p",{className:"desc text-center",children:j&&(null===j||void 0===j?void 0:j.min.date)?"Registrado el ".concat(null===j||void 0===j?void 0:j.min.date):""})]}),Object(D.jsx)(R.a,{sm:12,className:"d-flex align-items-center justify-content-end",children:Object(D.jsx)("p",{className:"numero acept text-center",children:j&&"number"===typeof(null===j||void 0===j?void 0:j.min.value)?j.min.value.toFixed(2):"-"})})]})}),Object(D.jsx)(u.a,{xs:6,sm:5,lg:12,children:Object(D.jsxs)(R.a,{className:"dato-calculado d-flex align-items-center justify-content-center",children:[Object(D.jsx)(R.a,{sm:12,children:Object(D.jsx)("p",{className:"tipo text-center",children:"Promedio"})}),Object(D.jsx)(R.a,{sm:12,className:"d-flex align-items-center justify-content-end",children:Object(D.jsx)("p",{className:"numero mala text-center",children:j&&"number"===typeof(null===j||void 0===j?void 0:j.avg.value)?j.avg.value.toFixed(2):"-"})})]})}),Object(D.jsx)(u.a,{xs:6,sm:5,lg:12,children:Object(D.jsxs)(R.a,{className:"dato-calculado d-flex align-items-center justify-content-center",children:[Object(D.jsx)(R.a,{sm:12,className:"d-flex align-items-center justify-content-center",children:Object(D.jsx)("p",{className:"tipo text-center",children:"Arriba de la norma"})}),Object(D.jsx)(R.a,{sm:12,className:"d-flex align-items-center justify-content-center",children:Object(D.jsx)("p",{className:"numero text-center ".concat(j?0===j.porcentajes.arribaLimite?"bueno":j.porcentajes.arribaLimite>25?"muymala":"mala":null),children:j?j.porcentajes.arribaLimite+"%":"-"})})]})}),Object(D.jsx)(u.a,{xs:12,sm:5,lg:12,children:Object(D.jsxs)(R.a,{className:"dato-calculado",children:[Object(D.jsxs)(u.a,{xs:6,sm:6,className:"d-flex flex-column align-items-center justify-content-center",children:[Object(D.jsx)("p",{className:"tipo text-center",children:"Datos V\xe1lidos"}),Object(D.jsx)("p",{className:"numero bueno text-center",children:j?j.porcentajes.buenos+"%":"-"})]}),Object(D.jsxs)(u.a,{xs:6,sm:6,className:"d-flex flex-column align-items-center justify-content-center",children:[Object(D.jsx)("p",{className:"tipo text-center",children:"Datos Nulos"}),Object(D.jsx)("p",{className:"numero muymala text-center",children:j?j.porcentajes.nulos+"%":"-"})]})]})})]})]}),Object(D.jsx)(u.a,{sm:12,lg:8,xl:10,children:Object(D.jsxs)("div",{className:"grafico mb-4",children:[l&&Object(D.jsx)(L.a,{className:"grafico-resize",data:l,layout:r,config:{responsive:!0}}),"undefined"==typeof l&&Object(D.jsx)("div",{children:"Seleccionar un sensor, contaminante y fechas para ver sus datos"})]})}),Object(D.jsx)(R.a,{className:"d-block d-sm-none w-100",xs:11,children:Object(D.jsx)("p",{children:"*Para una mejor visualizaci\xf3n, utiliza el telefono horizontalmente."})})]})]})},k=(a(95),a(143));i.a.locale("es");var w=Object(s.lazy)((function(){return Promise.all([a.e(8),a.e(9)]).then(a.bind(null,152))})),A=Object(s.lazy)((function(){return Promise.all([a.e(13),a.e(12)]).then(a.bind(null,141))}));t.default=function(){var e=Object(s.useState)(null),t=Object(c.a)(e,2),a=t[0],l=t[1],r=Object(s.useState)(null),o=Object(c.a)(r,2),u=o[0],d=o[1],j=Object(s.useState)("1"),b=Object(c.a)(j,2),m=b[0],O=b[1],f=Object(s.useState)(null),x=Object(c.a)(f,2),h=x[0],v=x[1],p=Object(s.useState)(!1),g=Object(c.a)(p,2),N=g[0],y=g[1],P=Object(s.useState)(!1),S=Object(c.a)(P,2),Y=S[0],R=S[1],E=Object(s.useState)(null),L=Object(c.a)(E,2),H=L[0],T=L[1],F=Object(s.useState)(null),U=Object(c.a)(F,2),z=U[0],G=U[1],V=Object(s.useState)("00:00:00"),B=Object(c.a)(V,2),I=B[0],q=B[1],Q=Object(s.useState)("00:00:00"),K=Object(c.a)(Q,2),W=K[0],J=K[1],Z=Object(s.useRef)({value:"PM25"}),X=Object(s.useRef)(null),$=Object(s.useRef)(null);function ee(e,t){if(X.current){e&&t||(e=H,t=z);var a="ubic=";a+=X.current.value,a+="&ind="+Z.current.value+"&inicio="+e.format("YYYY-MM-DD")+"&fin="+t.format("YYYY-MM-DD"),v(a)}else alert("Selecciona una ubicaci\xf3n.")}function te(){var e=function(){if(h){var e="location=";return(e+=X.current.value)+("2"===m?"&gas="+Z.current.value+"&start_date="+H.startOf("month").format("YYYY-MM-DD")+"&end_date="+z.endOf("month").format("YYYY-MM-DD"):"&gas="+Z.current.value+"&start_date="+H.format("YYYY-MM-DD")+"&end_date="+z.format("YYYY-MM-DD"))}return null}();e&&fetch("".concat(C.a,"/download-data?").concat(e)).then((function(e){return e.blob()})).then((function(e){var t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="data.csv";a.addEventListener("click",(function e(){setTimeout((function(){URL.revokeObjectURL(t),a.removeEventListener("click",e)}),150)}),!1),a.click()}))}return Object(s.useEffect)((function(){h&&("1"===m?fetch("".concat(C.a,"/get-graph-opt?").concat(h)).then((function(e){return e.json()})).then((function(e){e.hasOwnProperty("message")&&R(!0);var t=[];e.plot.data&&e.plot.data[0].x.forEach((function(e){var a=i.a.duration("05:00:00");e=i()(e).subtract(a).format(),t.push(e.split("-05:00")[0])})),e.plot.data[0].x=t,l(e.plot),d(e.summary),y(!1)})):fetch("".concat(C.a,"/datos-fecha?").concat(h)).then((function(e){return e.json()})).then((function(e){return l(e)})))}),[h]),Object(s.useEffect)((function(){l(null)}),[m]),Object(D.jsxs)("div",{className:"container mb-10",children:[Object(D.jsxs)(k.a,{show:Y,onHide:function(){return R(!1)},"aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(D.jsx)(k.a.Header,{closeButton:!0,children:Object(D.jsx)("h5",{children:"Datos no encontrados"})}),Object(D.jsx)(k.a.Body,{children:Object(D.jsx)("p",{children:"Revise los parametros e intente de nuevo."})})]}),Object(D.jsx)(M,{createQueryGraph:function(){if(X.current)if(H&&z){y(!0);var e="location=".concat(X.current.label,"&gas=").concat(Z.current.value,"&system=").concat($.current.opt,"&start_date=").concat(i.a.utc(H).format("MM/DD/YYYY"),"/").concat(I,"&end_date=").concat(i.a.utc(z).format("MM/DD/YYYY"),"/").concat(W);v(e)}else alert("Selecciona las fechas.");else alert("Selecciona una ubicaci\xf3n.")},createQueryCal:ee,radioValue:m,setRadioValue:O,updateMainFiltros:function(e,t,a){$.current=a,X.current=e,Z.current=t}}),Object(D.jsx)("div",{className:"text-center",children:Object(D.jsx)("img",{src:"loading.gif",alt:"Cargando...",className:"loading",style:N?{}:{display:"none"}})}),"1"===m&&Object(D.jsx)(_,Object(n.a)({setDesde:T,setHasta:G,setDesdeHora:q,setHastaHora:J,downloadFile:te,summary:u},a)),"2"===m&&Object(D.jsx)(D.Fragment,{children:Object(D.jsxs)(s.Suspense,{fallback:Object(D.jsx)("div",{children:"Loading..."}),children:[Object(D.jsx)(w,{q:h,create:ee,data:a,indi:Z.current.value,setDesde:T,setHasta:G,downloadFile:te}),Object(D.jsx)(A,{q:h,fecha:H,ubic:X.current,ind:Z.current.value})]})})]})}},82:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"g",(function(){return c})),a.d(t,"e",(function(){return s})),a.d(t,"h",(function(){return l})),a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return i})),a.d(t,"f",(function(){return o})),a.d(t,"a",(function(){return u}));var n=[{name:"PM25",label:"PM2.5",units:"\u03bcg/m3"},{name:"PM10",units:"\u03bcg/m3"},{name:"O3",units:"ppm"},{name:"CO",units:"ppm"},{name:"NO2",units:"ppm"},{name:"SO2",units:"ppm"}],c=[{value:"PurpleAir",label:"PurpleAir",opt:"P"},{value:"Sinaica",label:"Sinaica",opt:"G"},{value:"AireNuevoLeon",label:"AireNuevoLeon",opt:"G"}],s=[{value:"PM25",label:"PM2.5"},{value:"PM10",label:"PM10"},{value:"O3",label:"O3"},{value:"CO",label:"CO"},{value:"NO2",label:"NO2"},{value:"SO2",label:"SO2"}],l={PM25:"\xb5g/m3",PM10:"\xb5g/m3",CO:"ppm",O3:"ppm",NO2:"ppm",SO2:"ppm"},r=["P36757","P47305","P39499","P46239","P50855","P35099","P39709","P39497","P39285","P39355"],i=["P39497","P39285","P39355"],o=["Sinaica"],u=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL},87:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(82),c=function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(c,s){t().then(c).catch((function(){setTimeout((function(){if(!n)return s("Se excedi\xf3 el n\xfamero m\xe1ximo de intentos");e(t,a,n-1).then(c,s)}),a)}))}))},s=function(){return new Promise((function(e,t){fetch("".concat(n.a,"/sensor-summary")).then((function(e){if(200===e.status)return e.json();t()})).then((function(t){e(t)})).catch((function(e){return t(e)}))}))},l=function(){return c(s)}}}]);
//# sourceMappingURL=11.6e26636c.chunk.js.map