{"version":3,"sources":["components/HeatMap.js","handlers/statusCriteria.js"],"names":["HeatMap","q","fecha","ubic","ind","useState","mes","setMes","dataHM","setDataHM","queryAnt","useRef","mesAnt","queryStr","useEffect","isSame","clone","startOf","current","newq","substring","indexOf","value","format","endOf","fetch","apiUrl","then","response","json","catch","e","console","log","options","series","length","index","dataItem","currUbic","primerDia","Date","replace","currDia","seriesItem","name","data","getDate","x","y","push","parseInt","chart","type","toolbar","show","plotOptions","heatmap","enableShades","radius","useFillColorAsStroke","colorScale","ranges","from","to","color","criteria","dataLabels","enabled","stroke","width","xaxis","position","legend","showForSingleSeries","tooltip","custom","seriesIndex","dataPointIndex","w","globals","initialSeries","toFixed","unidad","className","height","PM10","PM25","O3","CO","SO2","NO2","NOM","airQualityTags","getStatus","gas","norm","breakpoints","i"],"mappings":"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","file":"static/js/12.ce449c52.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport Chart from 'react-apexcharts';\r\nimport { apiUrl } from '../constants';\r\nimport { criteria } from '../handlers/statusCriteria';\r\nimport { unidad } from '../constants';\r\n\r\n// Componente para la página Registro Histórico, sección del calendario\r\nfunction HeatMap({ q, fecha, ubic, ind }) {\r\n    /* \r\n        Parámetros:\r\n            - q : query que proviene de RHFiltros\r\n            - fecha : dia seleccionada en el calendario\r\n            - ubic : sensores seleccionados en los filtros\r\n            - ind : gas seleccionado en los filtros\r\n    */\r\n\r\n    const [mes, setMes] = useState(null);\r\n    const [dataHM, setDataHM] = useState(null);\r\n\r\n    const queryAnt = useRef(null);\r\n    const mesAnt = useRef(mes);\r\n    let queryStr = \"\";\r\n\r\n    useEffect(() => {\r\n        if (fecha) {\r\n            // Cuando cambia la fecha seleccionada en el calendario, solo cambiamos el State del mes si sí cambió el mes\r\n            if (!mes || !mes.isSame(fecha.clone().startOf('month'))) {\r\n                mesAnt.current = mes;\r\n                setMes(fecha.clone().startOf('month'));\r\n            }\r\n        }\r\n    }, [fecha]);\r\n\r\n    useEffect(() => {\r\n        let newq = \"\";\r\n        if (q) {\r\n            newq = q.substring(0, q.indexOf(\"&inicio\")); // solo nos interesa saber las ubicaciones y gases seleccionados\r\n        }\r\n\r\n        if (!queryAnt.current || queryAnt.current !== newq || mesAnt.current != mes) { // Cambió la ubicación y gases seleccionados o el mes seleccionado\r\n            if (queryAnt.current !== q) queryAnt.current = newq;\r\n            if (mesAnt.current != mes) mesAnt.current = mes;\r\n\r\n            if (ubic && mes) {\r\n                // Creamos query, sacando los datos de todo el mes\r\n                queryStr = 'ubic=';\r\n                queryStr += ubic.value\r\n\r\n                queryStr +=\r\n                    '&ind=' + ind +\r\n                    '&inicio=' + mes.clone().format(\"YYYY-MM-DD\") +\r\n                    '&fin=' + mes.clone().endOf('month').format('YYYY-MM-DD');\r\n\r\n\r\n                fetch(`${apiUrl}/prom-data?${queryStr}`)\r\n                    .then(response => response.json())\r\n                    .then((json) => setDataHM(json))\r\n                    .catch((e) => console.log(e));\r\n\r\n            }\r\n        }\r\n    }, [q, mes]);\r\n\r\n    // Creación del Heatmap:\r\n    var options = {}; // Configuración\r\n    var series = []; // Datos\r\n\r\n    if (q && dataHM && dataHM.length > 0) {\r\n        /* EJEMPLO DEL FORMATO\r\n        series:[\r\n            {\r\n                name: dataHM[i][\"zona\"]\r\n                data: [\r\n                    {\r\n                        x: número del día,\r\n                        y: dataHM[i][ind],\r\n                        fecha: dataHM[i][fecha].format(\"DD-MM-YYYY\")\r\n                    }\r\n                ]\r\n            }\r\n        ] */\r\n        let index = 0;\r\n        let dataItem = {};\r\n\r\n        // Este codigo de abajo se cambio porque ya no era un array de ubicaciones se cambio solo a una ubicación\r\n\r\n        // for (let u = 0; u < ubic.length && dataHM[index]; u++) { // Por cada ubicacion seleccionada se crea una fila del heatmap\r\n        // let currUbic = dataHM[index][\"zona\"];\r\n        let currUbic = dataHM[index][\"zona\"];\r\n        let primerDia = new Date(dataHM[index].fecha.replace(/-/g, '\\/').replace(/T.+/, '')); // primer día registrado de los datos de una ubicacion\r\n        let currDia = 1;\r\n\r\n        let seriesItem = {\r\n            name: currUbic,\r\n            data: []\r\n        };\r\n\r\n        // llenar primeros días vacíos si es que los datos del mes no empiezan en el primer día\r\n        while (primerDia.getDate() !== currDia) {\r\n            dataItem.x = currDia;\r\n            dataItem.y = -1;\r\n            seriesItem.data.push({ ...dataItem });\r\n            currDia++;\r\n        }\r\n\r\n\r\n        // ahora sí hay datos\r\n        while (index < dataHM.length && dataHM[index][\"zona\"] === currUbic) {\r\n            dataItem.x = currDia;\r\n\r\n            // revisa que sí haya un registro de ese dia checando si coincide el número de día\r\n            if (currDia === parseInt(dataHM[index][\"fecha\"].substring(8))) {\r\n                if (dataHM[index][\"prom\"] !== \"\") {\r\n                    dataItem.y = dataHM[index][\"prom\"];\r\n                    dataItem.fecha = dataHM[index][\"fecha\"];\r\n                } else {\r\n                    dataItem.y = -1;\r\n                }\r\n                index++;\r\n            } else {\r\n                dataItem.y = -1;\r\n            }\r\n\r\n            seriesItem.data.push({ ...dataItem });\r\n            currDia++;\r\n        }\r\n\r\n        series.push({ ...seriesItem });\r\n\r\n        options = {\r\n            chart: {\r\n                type: 'heatmap',\r\n                toolbar: {\r\n                    show: false\r\n                }\r\n            },\r\n            plotOptions: {\r\n                heatmap: {\r\n                    enableShades: false,\r\n                    radius: 1,\r\n                    useFillColorAsStroke: false,\r\n                    colorScale: {\r\n                        ranges: [\r\n                            {\r\n                                from: -2,\r\n                                to: 0,\r\n                                name: 'No data',\r\n                                color: '#D3D3D3'\r\n                            },\r\n                            {\r\n                                from: 0,\r\n                                to: criteria['Aire y Salud'][ind][0],\r\n                                name: 'Buena',\r\n                                color: '#00E400'\r\n                            },\r\n                            {\r\n                                from: criteria['Aire y Salud'][ind][0],\r\n                                to: criteria['Aire y Salud'][ind][1],\r\n                                name: 'Aceptable',\r\n                                color: '#FFFF00'\r\n                            },\r\n                            {\r\n                                from: criteria['Aire y Salud'][ind][1],\r\n                                to: criteria['Aire y Salud'][ind][2],\r\n                                name: 'Mala',\r\n                                color: '#FF7E00'\r\n                            },\r\n                            {\r\n                                from: criteria['Aire y Salud'][ind][2],\r\n                                to: criteria['Aire y Salud'][ind][3],\r\n                                name: 'Muy mala',\r\n                                color: '#FF0000'\r\n                            },\r\n                            {\r\n                                from: criteria['Aire y Salud'][ind][3],\r\n                                to: criteria['Aire y Salud'][ind][3] * 1.5,\r\n                                name: 'Extremadamente mala',\r\n                                color: '#8F3F97'\r\n                            }\r\n                        ]\r\n                    }\r\n                }\r\n            },\r\n            dataLabels: {\r\n                enabled: false\r\n            },\r\n            stroke: {\r\n                width: 1\r\n            },\r\n            xaxis: {\r\n                position: \"bottom\"\r\n            },\r\n            legend: {\r\n                position: \"top\",\r\n                showForSingleSeries: true\r\n            },\r\n            tooltip: {\r\n                custom: function ({ series, seriesIndex, dataPointIndex, w }) {\r\n                    if (series[seriesIndex][dataPointIndex] !== -1) {\r\n                        return '<div class=\"arrow_box hmTooltip\">' +\r\n                            '<p>' + w.globals.initialSeries[seriesIndex].data[dataPointIndex].fecha + '</p>' +\r\n                            '<p><b>' + series[seriesIndex][dataPointIndex].toFixed(4) + ' ' +\r\n                            unidad[ind] + '</b></p>' +\r\n                            '</div>'\r\n                    }\r\n                    return '<div style=\"display:none;\">'\r\n                }\r\n            }\r\n        };\r\n\r\n    }\r\n\r\n\r\n    return (\r\n        <div>\r\n            <h3 className=\"mb-5\">Promedios diarios del mes</h3>\r\n            {q && (<Chart options={options} series={series} type=\"heatmap\" height={series.length * 100} />)}\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n\r\nexport default HeatMap\r\n","export const criteria = {\r\n    'Aire y Salud': {\r\n        PM10: [50, 75, 155, 235],\r\n        PM25: [25, 45, 78, 147],\r\n        O3: [0.051, 0.095, 0.135, 0.175],\r\n        CO: [8.75, 11.00, 13.30, 15.50],\r\n        SO2: [0.008, 0.110, 0.165, 0.220],\r\n        NO2: [0.107, 0.210, 0.230, 0.250],\r\n    },\r\n    NOM: {\r\n        PM10: [100, 135, 214, 300],\r\n        PM25: [55, 75, 97.4, 128.8],\r\n        O3: [0.07, 0.093, 0.115, 0.137],\r\n        CO: [12, 13.9, 15.9, 18.9],\r\n        SO2: [0.253, 0.345, 0.435, 0.566],\r\n        NO2: [0.132, 0.176, 0.221, 0.289],\r\n    },\r\n};\r\n\r\nexport const airQualityTags = [\"buena\", \"acept\", \"mala\", \"muy\", \"ext\"];\r\n\r\nexport const getStatus = (gas, value, norm = 'Aire y Salud') => {\r\n    const breakpoints = criteria[norm][gas];\r\n\r\n    for (let i = breakpoints.length - 1; i >= 0; i--) {\r\n        if (value > breakpoints[i]) {\r\n            return parseInt(i) + 1;\r\n        }\r\n    }\r\n\r\n    return 0;\r\n};\r\n"],"sourceRoot":""}